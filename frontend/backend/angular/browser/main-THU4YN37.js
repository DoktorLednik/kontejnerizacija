import{$ as _e,A as D,Aa as H,B as ie,C as ne,D as re,E as A,F as oe,G as ae,H as $,I as se,J as me,K as ce,L as pe,M as le,N as V,O as N,P as ue,Q as L,R as de,S as g,T as fe,U as I,V as R,W as he,X as ge,Y as ye,Z as ve,_ as U,a as Q,aa as Ce,b as W,ba as xe,c as X,ca as K,d as Y,da as Se,e as Z,ea as ke,f as ee,fa as be,g as b,h as w,ha as z,i as _,j as C,ja as Ie,k as P,ka as Me,l as x,la as we,m as S,n as F,o as m,p as f,pa as Pe,q as c,qa as Ae,r as y,ra as Le,s,sa as Ke,t as a,ta as Ee,u as h,ua as Oe,v as M,va as Te,w as k,wa as je,x as d,xa as Fe,y as te,ya as De,z as l,za as Ve}from"./chunk-P4AOUVWB.js";var E=de.apiUrl+"/keys/",B=(()=>{let e=class e{constructor(n,i){this.http=n,this.router=i,this.keys=[],this.keysUpdated=new W}getKeys(n,i){let r=`?pagesize=${n}&page=${i}`;this.http.get(E+r).pipe(Z(p=>({keys:p.keys.map(u=>({title:u.title,content:u.content,id:u._id,imagePath:u.imagePath,creator:u.creator})),maxKeys:p.maxKeys}))).subscribe(p=>{this.keys=p.keys,this.keysUpdated.next({keys:[...this.keys],keyCount:p.maxKeys})})}getKeyUpdateListener(){return this.keysUpdated.asObservable()}getKey(n){return this.http.get(E+n)}addKey(n,i,r){let p=new FormData;p.append("title",n),p.append("content",i),p.append("image",r,n),this.http.post(E,p).subscribe(u=>{this.router.navigate(["/"])})}updateKey(n,i,r,p){let u;typeof p=="object"?(u=new FormData,u.append("id",n),u.append("title",i),u.append("content",r),u.append("image",p,i)):u={id:n,title:i,content:r,imagePath:p,creator:null},this.http.put(E+n,u).subscribe(j=>{this.router.navigate(["/"])})}deleteKey(n){return this.http.delete(E+n)}};e.\u0275fac=function(i){return new(i||e)(_(ae),_(V))},e.\u0275prov=b({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Ye(t,e){t&1&&h(0,"mat-spinner")}var Ze=t=>["/edit",t];function et(t,e){if(t&1){let o=M();s(0,"mat-action-row")(1,"a",9),l(2,"EDIT"),a(),s(3,"button",10),k("click",function(){x(o);let i=d().$implicit,r=d(2);return S(r.onDelete(i.id))}),l(4,"DELETE"),a()()}if(t&2){let o=d().$implicit;m(1),c("routerLink",ne(1,Ze,o.id))}}function tt(t,e){if(t&1&&(s(0,"mat-expansion-panel",6)(1,"mat-expansion-panel-header"),l(2),a(),s(3,"div",7),h(4,"img",8),a(),s(5,"p"),l(6),a(),y(7,et,5,3,"mat-action-row",0),a()),t&2){let o=e.$implicit,n=d(2);m(2),ie(" ",o.title," "),m(2),c("src",o.imagePath,F)("alt",o.title),m(2),D(o.content),m(1),c("ngIf",n.userIsAuthenticated&&n.userId===o.creator)}}function it(t,e){if(t&1&&(s(0,"mat-accordion",4),y(1,tt,8,5,"mat-expansion-panel",5),a()),t&2){let o=d();m(1),c("ngForOf",o.keys)}}function nt(t,e){if(t&1){let o=M();s(0,"mat-paginator",11),k("page",function(i){x(o);let r=d();return S(r.onChangedPage(i))}),a()}if(t&2){let o=d();c("length",o.totalKeys)("pageSize",o.keysPerPage)("pageSizeOptions",o.pageSizeOptions)}}function rt(t,e){t&1&&(s(0,"p",12),l(1,"No keys added!"),a())}var Ue=(()=>{let e=class e{constructor(n,i){this.keysService=n,this.authService=i,this.keys=[],this.isLoading=!1,this.totalKeys=0,this.keysPerPage=2,this.currentPage=1,this.pageSizeOptions=[1,2,5,10],this.userIsAuthenticated=!1}ngOnInit(){this.isLoading=!0,this.keysService.getKeys(this.keysPerPage,this.currentPage),this.userId=this.authService.getUserId(),this.keysSub=this.keysService.getKeyUpdateListener().subscribe(n=>{this.isLoading=!1,this.totalKeys=n.keyCount,this.keys=n.keys}),this.userIsAuthenticated=this.authService.getIsAuth(),this.authStatusSub=this.authService.getAuthStatusListener().subscribe(n=>{this.userIsAuthenticated=n,this.userId=this.authService.getUserId()})}onChangedPage(n){this.isLoading=!0,this.currentPage=n.pageIndex+1,this.keysPerPage=n.pageSize,this.keysService.getKeys(this.keysPerPage,this.currentPage)}onDelete(n){this.isLoading=!0,this.keysService.deleteKey(n).subscribe(()=>{this.keysService.getKeys(this.keysPerPage,this.currentPage)},()=>{this.isLoading=!1})}ngOnDestroy(){this.keysSub.unsubscribe(),this.authStatusSub.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)(f(B),f(g))},e.\u0275cmp=C({type:e,selectors:[["app-key-list"]],decls:4,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","info-text mat-body-1",4,"ngIf"],["multi","true"],["class","key-panel",4,"ngFor","ngForOf"],[1,"key-panel"],[1,"key-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"length","pageSize","pageSizeOptions","page"],[1,"info-text","mat-body-1"]],template:function(i,r){i&1&&y(0,Ye,1,0,"mat-spinner",0)(1,it,2,1,"mat-accordion",1)(2,nt,1,3,"mat-paginator",2)(3,rt,2,0,"p",3),i&2&&(c("ngIf",r.isLoading),m(1),c("ngIf",r.keys.length>0&&!r.isLoading),m(1),c("ngIf",r.keys.length>0),m(1),c("ngIf",r.keys.length<=0&&!r.isLoading))},dependencies:[re,A,R,I,ve,he,ge,ye,U,Ae,N],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}.key-image[_ngcontent-%COMP%]{width:100%}.key-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;box-shadow:1px 1px 5px #00000080}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}"]});let t=e;return t})();var ze=t=>{if(typeof t.value=="string")return X(null);let e=t.value,o=new FileReader;return Q.create(i=>{o.addEventListener("loadend",()=>{let r=new Uint8Array(o.result).subarray(0,4),p="",u=!1;for(let j=0;j<r.length;j++)p+=r[j].toString(16);switch(p){case"89504e47":u=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":u=!0;break;default:u=!1;break}u?i.next(null):i.next({invalidMimeType:!0}),i.complete()}),o.readAsArrayBuffer(e)})};function ot(t,e){t&1&&h(0,"mat-spinner")}function at(t,e){t&1&&(s(0,"mat-error"),l(1,"Please enter a valid number."),a())}function st(t,e){if(t&1&&(s(0,"div",10),h(1,"img",11),a()),t&2){let o=d(2);m(1),c("src",o.imagePreview,F)("alt",o.form.value.title)}}function mt(t,e){t&1&&(s(0,"mat-error"),l(1,"Please enter a description."),a())}function ct(t,e){if(t&1){let o=M();s(0,"form",2),k("submit",function(){x(o);let i=d();return S(i.onSaveKey())}),s(1,"mat-form-field"),h(2,"input",3),y(3,at,2,0,"mat-error",0),a(),s(4,"div")(5,"button",4),k("click",function(){x(o);let i=te(8);return S(i.click())}),l(6,"Pick Image"),a(),s(7,"input",5,6),k("change",function(i){x(o);let r=d();return S(r.onImagePicked(i))}),a()(),y(9,st,2,2,"div",7),s(10,"mat-form-field")(11,"textarea",8),l(12,"      "),a(),y(13,mt,2,0,"mat-error",0),a(),s(14,"button",9),l(15,"Save Key"),a()()}if(t&2){let o=d();c("formGroup",o.form),m(3),c("ngIf",o.form.get("title").invalid),m(6),c("ngIf",o.imagePreview!==""&&o.imagePreview&&o.form.get("image").valid),m(4),c("ngIf",o.form.get("content").invalid)}}var J=(()=>{let e=class e{constructor(n,i,r){this.keysService=n,this.route=i,this.authService=r,this.enteredTitle="",this.enteredContent="",this.isLoading=!1,this.mode="create"}ngOnInit(){this.authStatusSub=this.authService.getAuthStatusListener().subscribe(n=>{this.isLoading=!1}),this.form=new be({title:new z(null,{validators:[K.required,K.minLength(3)]}),content:new z(null,{validators:[K.required]}),image:new z(null,{validators:[K.required],asyncValidators:[ze]})}),this.route.paramMap.subscribe(n=>{n.has("keyId")?(this.mode="edit",this.keyId=n.get("keyId"),this.isLoading=!0,this.keysService.getKey(this.keyId).subscribe(i=>{this.isLoading=!1,this.key={id:i._id,title:i.title,content:i.content,imagePath:i.imagePath,creator:i.creator},this.form.setValue({title:this.key.title,content:this.key.content,image:this.key.imagePath})})):(this.mode="create",this.keyId=null)})}onImagePicked(n){let i=n.target.files[0];this.form.patchValue({image:i}),this.form.get("image").updateValueAndValidity();let r=new FileReader;r.onload=()=>{this.imagePreview=r.result},r.readAsDataURL(i)}onSaveKey(){this.form.invalid||(this.isLoading=!0,this.mode==="create"?this.keysService.addKey(this.form.value.title,this.form.value.content,this.form.value.image):this.keysService.updateKey(this.keyId,this.form.value.title,this.form.value.content,this.form.value.image),this.form.reset())}ngOnDestroy(){this.authStatusSub.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)(f(B),f(pe),f(g))},e.\u0275cmp=C({type:e,selectors:[["app-key-create"]],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"formGroup","submit"],["matInput","","type","text","formControlName","title","placeholder","Key ID"],["mat-stroked-button","","type","button",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["matInput","","rows","4","formControlName","content","placeholder","Key description"],["mat-raised-button","","color","primary","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(i,r){i&1&&(s(0,"mat-card"),y(1,ot,1,0,"mat-spinner",0)(2,ct,16,4,"form",1),a()),i&2&&(m(1),c("ngIf",r.isLoading),m(1),c("ngIf",!r.isLoading))},dependencies:[A,Ie,xe,Se,ke,Me,we,Le,Ce,_e,Ke,I,U],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]});let t=e;return t})();var G=(()=>{let e=class e{constructor(n,i){this.authService=n,this.router=i}canActivate(n,i){let r=this.authService.getIsAuth();return r||this.router.navigate(["/auth/login"]),r}};e.\u0275fac=function(i){return new(i||e)(_(g),_(V))},e.\u0275prov=b({token:e,factory:e.\u0275fac});let t=e;return t})();var pt=[{path:"",component:Ue},{path:"create",component:J,canActivate:[G]},{path:"edit/:keyId",component:J,canActivate:[G]},{path:"auth",loadChildren:()=>import("./chunk-7XUBRCMO.js").then(t=>t.AuthModule)}],He=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=P({type:e}),e.\u0275inj=w({providers:[G],imports:[L.forRoot(pt),L]});let t=e;return t})();function lt(t,e){t&1&&(s(0,"li")(1,"a",4),l(2,"New Key"),a()())}function ut(t,e){t&1&&(s(0,"li")(1,"a",5),l(2,"Login"),a()())}function dt(t,e){t&1&&(s(0,"li")(1,"a",6),l(2,"Signup"),a()())}function ft(t,e){if(t&1){let o=M();s(0,"li")(1,"button",7),k("click",function(){x(o);let i=d();return S(i.onLogout())}),l(2,"Logout"),a()()}}var Be=(()=>{let e=class e{constructor(n){this.authService=n,this.userIsAuthenticated=!1}ngOnInit(){this.userIsAuthenticated=this.authService.getIsAuth(),this.authListenerSubs=this.authService.getAuthStatusListener().subscribe(n=>{this.userIsAuthenticated=n})}onLogout(){this.authService.logout()}ngOnDestroy(){this.authListenerSubs.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)(f(g))},e.\u0275cmp=C({type:e,selectors:[["app-header"]],decls:10,vars:4,consts:[["color","primary"],["routerLink","/"],[1,"spacer"],[4,"ngIf"],["mat-button","","routerLink","/create","routerLinkActive","mat-accent"],["mat-button","","routerLink","/auth/login","routerLinkActive","mat-accent"],["mat-button","","routerLink","/auth/signup","routerLinkActive","mat-accent"],["mat-button","",3,"click"]],template:function(i,r){i&1&&(s(0,"mat-toolbar",0)(1,"span")(2,"a",1),l(3,"MyKeys"),a()(),h(4,"span",2),s(5,"ul"),y(6,lt,3,0,"li",3)(7,ut,3,0,"li",3)(8,dt,3,0,"li",3)(9,ft,3,0,"li",3),a()()),i&2&&(m(6),c("ngIf",r.userIsAuthenticated),m(1),c("ngIf",!r.userIsAuthenticated),m(1),c("ngIf",!r.userIsAuthenticated),m(1),c("ngIf",r.userIsAuthenticated))},dependencies:[A,N,ue,R,I,Ee],styles:["ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}ul[_ngcontent-%COMP%]{display:flex}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});let t=e;return t})();var Ge=(()=>{let e=class e{constructor(n){this.authService=n}ngOnInit(){this.authService.autoAuthUser()}};e.\u0275fac=function(i){return new(i||e)(f(g))},e.\u0275cmp=C({type:e,selectors:[["app-root"]],decls:3,vars:0,template:function(i,r){i&1&&(h(0,"app-header"),s(1,"main"),h(2,"router-outlet"),a())},dependencies:[le,Be],styles:["main[_ngcontent-%COMP%]{width:80%;margin:1rem auto}"]});let t=e;return t})();var $e=(()=>{let e=class e{constructor(n){this.authService=n}intercept(n,i){let r=this.authService.getToken(),p=n.clone({headers:n.headers.set("Authorization","Bearer "+r)});return i.handle(p)}};e.\u0275fac=function(i){return new(i||e)(_(g))},e.\u0275prov=b({token:e,factory:e.\u0275fac});let t=e;return t})();var qe=(()=>{let e=class e{constructor(n){this.data=n}};e.\u0275fac=function(i){return new(i||e)(f(Oe))},e.\u0275cmp=C({type:e,selectors:[["ng-component"]],decls:8,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"mat-body-1"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""]],template:function(i,r){i&1&&(s(0,"h1",0),l(1,"An Error Occured!"),a(),s(2,"div",1)(3,"p",2),l(4),a()(),s(5,"div",3)(6,"button",4),l(7,"Okay"),a()()),i&2&&(m(4),D(r.data.message))},dependencies:[I,je,Fe,Ve,De],encapsulation:2});let t=e;return t})();var Je=(()=>{let e=class e{constructor(n){this.dialog=n}intercept(n,i){return i.handle(n).pipe(ee(r=>{let p="An unknown error occurred.";return r.error.message&&(p=r.error.message),this.dialog.open(qe,{data:{message:p}}),Y(r)}))}};e.\u0275fac=function(i){return new(i||e)(_(Te))},e.\u0275prov=b({token:e,factory:e.\u0275fac});let t=e;return t})();var Qe=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=P({type:e}),e.\u0275inj=w({imports:[oe,Pe,H,L]});let t=e;return t})();var We=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=P({type:e,bootstrap:[Ge]}),e.\u0275inj=w({providers:[{provide:$,useClass:$e,multi:!0},{provide:$,useClass:Je,multi:!0}],imports:[ce,He,fe,se,H,Qe]});let t=e;return t})();me().bootstrapModule(We).catch(t=>console.error(t));
